import{C as F,T as M}from"./themeManager-CRIQpY6X.js";class L{constructor(e){this.token=e}static parseUrl(e){try{const t=new URL(e),o=t.pathname.split("/")[2],s=t.searchParams.get("node-id");if(!s)throw new Error("node-id n√£o encontrado na URL");const a=s.replace("-",":");return{fileKey:o,nodeId:a}}catch(t){return console.error("Erro ao analisar URL do Figma:",t),null}}async fetchFrame(e,t){try{const n=await fetch(`https://api.figma.com/v1/files/${e}/nodes?ids=${t}`,{headers:{"X-Figma-Token":this.token}});if(!n.ok)throw new Error(`Erro da API do Figma: ${n.status} ${n.statusText}`);const s=(await n.json()).nodes[t];if(!s||!s.document)throw new Error("Frame n√£o encontrado");return s.document}catch(n){throw console.error("Erro ao buscar frame do Figma:",n),n}}async validateToken(){try{return(await fetch("https://api.figma.com/v1/me",{headers:{"X-Figma-Token":this.token}})).ok}catch(e){return console.error("Erro ao validar token:",e),!1}}}const I=class I{static savePattern(e){const n=this.getPatterns().filter(o=>o.frameId!==e.frameId);n.push(e),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n))}static getPatterns(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Erro ao recuperar padr√µes:",e),[]}}static getPatternByFrameId(e){return this.getPatterns().find(n=>n.frameId===e)||null}static addFeedbackToPattern(e,t){const n=this.getPatterns(),o=n.findIndex(s=>s.frameId===e);if(o!==-1){n[o].feedback||(n[o].feedback=[]),n[o].feedback.push(t);const s=this.generateRulesFromFeedback(t);s.length>0&&(this.saveAnalysisRules(s),n[o].analysisRules||(n[o].analysisRules=[]),n[o].analysisRules.push(...s)),localStorage.setItem(this.STORAGE_KEY,JSON.stringify(n)),this.autoSaveFeedbackToFile(e,t)}}static autoSaveFeedbackToFile(e,t){const n={timestamp:new Date().toISOString(),frameId:e,feedback:t,userAgent:navigator.userAgent,sessionId:this.getOrCreateSessionId()},o=`figma-feedback-${e}-${Date.now()}.json`,s=JSON.stringify(n,null,2);this.downloadFile(s,o,"application/json"),console.log("üì§ Feedback salvo automaticamente:",o)}static getOrCreateSessionId(){const e="figma-analysis-session-id";let t=localStorage.getItem(e);return t||(t=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem(e,t)),t}static generateRulesFromFeedback(e){const t=[],n=`rule_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;switch(e.type){case"missed_component":e.componentName&&(t.push({id:n,type:"include",condition:{nodeName:e.componentName},action:{classify:e.expectedClassification||"disconnected"},confidence:.8,source:"user_feedback",createdAt:Date.now()}),e.componentName.includes("Rectangle")&&t.push({id:`${n}_pattern`,type:"include",condition:{namePattern:"Rectangle.*"},action:{classify:e.expectedClassification||"disconnected"},confidence:.6,source:"user_feedback",createdAt:Date.now()}));break;case"wrong_classification":e.componentName&&t.push({id:n,type:"classify",condition:{nodeName:e.componentName},action:{classify:e.expectedClassification||"disconnected"},confidence:.9,source:"user_feedback",createdAt:Date.now()});break;case"should_ignore":e.componentName&&t.push({id:n,type:"exclude",condition:{nodeName:e.componentName},action:{ignore:!0},confidence:.9,source:"user_feedback",createdAt:Date.now()});break}return t}static saveAnalysisRules(e){const o=[...this.getAnalysisRules(),...e].filter((s,a,i)=>a===i.findIndex(r=>r.id===s.id));localStorage.setItem(this.RULES_KEY,JSON.stringify(o))}static getAnalysisRules(){try{const e=localStorage.getItem(this.RULES_KEY);return e?JSON.parse(e):[]}catch(e){return console.error("Erro ao recuperar regras:",e),[]}}static applyRulesToComponent(e,t){const n=this.getAnalysisRules(),o=[];let s=!1,a,i=!1;const r=n.sort((c,l)=>l.confidence-c.confidence);for(const c of r){let l=!1;if(c.condition.nodeName&&c.condition.nodeName===e?l=!0:c.condition.namePattern?new RegExp(c.condition.namePattern).test(e)&&(l=!0):c.condition.nodeType&&c.condition.nodeType===t&&(l=!0),l){if(o.push(c),c.action.ignore){i=!0;break}c.action.classify&&(a=c.action.classify),c.type==="include"&&(s=!0)}}return{shouldInclude:s,classification:a,shouldIgnore:i,appliedRules:o}}static initializeKnownPatterns(){if(this.getPatterns().length>0)return;const t=[{frameId:"8287:54836",frameUrl:"https://www.figma.com/design/Ibss9YekrWOz9EbjaNBcB5/Gera%C3%A7%C3%A3o-e-leitura-do-CNAB?node-id=8287-54836",timestamp:Date.now(),components:{connected:1,disconnected:0}},{frameId:"8287:53586",frameUrl:"https://www.figma.com/design/Ibss9YekrWOz9EbjaNBcB5/Gera%C3%A7%C3%A3o-e-leitura-do-CNAB?node-id=8287-53586",timestamp:Date.now(),components:{connected:0,disconnected:1}},{frameId:"8287:54843",frameUrl:"https://www.figma.com/design/Ibss9YekrWOz9EbjaNBcB5/Gera%C3%A7%C3%A3o-e-leitura-do-CNAB?node-id=8287-54843",timestamp:Date.now(),components:{connected:1,disconnected:1}}];localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}static saveToken(e){localStorage.setItem(this.TOKEN_KEY,e)}static getToken(){return localStorage.getItem(this.TOKEN_KEY)}static clearToken(){localStorage.removeItem(this.TOKEN_KEY)}static exportToCsv(e,t){const n=["Nome do Componente","Tipo","Conectado ao DS","Prioridade","Node ID"],o=e.map(a=>[a.name,a.type,a.isConnectedToDS?"Sim":"N√£o",a.priority,a.nodeId]);return[n.join(","),...o.map(a=>a.join(","))].join(`
`)}static downloadCsv(e,t){const n=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");if(o.download!==void 0){const s=URL.createObjectURL(n);o.setAttribute("href",s),o.setAttribute("download",t),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}static downloadFile(e,t,n){const o=new Blob([e],{type:`${n};charset=utf-8;`}),s=document.createElement("a");if(s.download!==void 0){const a=URL.createObjectURL(o);s.setAttribute("href",a),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}static exportAllLearningData(){const e=this.getPatterns(),t=this.getAnalysisRules(),n=this.getLearningStats(),o={exportInfo:{timestamp:new Date().toISOString(),version:"1.0.0",sessionId:this.getOrCreateSessionId(),userAgent:navigator.userAgent},statistics:n,patterns:e,rules:t},s=`figma-learning-data-export-${Date.now()}.json`,a=JSON.stringify(o,null,2);this.downloadFile(a,s,"application/json"),console.log("üì¶ Dados de aprendizado exportados:",s)}static clearAllData(){localStorage.removeItem(this.STORAGE_KEY),localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.RULES_KEY)}static getLearningStats(){const e=this.getPatterns(),t=this.getAnalysisRules(),n=e.reduce((s,a)=>{var i;return s+(((i=a.feedback)==null?void 0:i.length)||0)},0),o=t.reduce((s,a)=>(s[a.type]=(s[a.type]||0)+1,s),{});return{totalPatterns:e.length,totalFeedbacks:n,totalRules:t.length,rulesBreakdown:o}}};I.STORAGE_KEY="figma-component-analysis-patterns",I.TOKEN_KEY="figma-token",I.RULES_KEY="figma-analysis-rules";let m=I;class B{static analyzeFrame(e,t){const n=[];this.extractComponents(e,n,0);const o=this.filterRelevantComponents(n),s=o.filter(i=>i.isConnectedToDS).length,a=o.filter(i=>!i.isConnectedToDS).length;return{components:o,summary:{connected:s,disconnected:a,total:s+a},frameInfo:{name:e.name,nodeId:e.id,url:t}}}static extractComponents(e,t,n){if(n===0&&e.children){e.children.forEach(s=>{this.extractComponents(s,t,n+1)});return}if(e.name.startsWith("_"))return;console.log(`üîç Analisando node: "${e.name}" (${e.type}) - componentId: ${e.componentId||"null"} - depth: ${n}`);const o=m.applyRulesToComponent(e.name,e.type);if(o.shouldIgnore){console.log(`üö´ Ignorando componente "${e.name}" devido a regra aprendida`);return}if(e.type==="INSTANCE"){let s=!1;o.classification?s=o.classification==="connected":s=!!(e.componentId&&e.componentId.trim()!==""),console.log(`üìç INSTANCE "${e.name}": componentId="${e.componentId}" ‚Üí ${s?"CONECTADO":"DESCONECTADO"}`),t.push({name:e.name,type:"INSTANCE",isConnectedToDS:s,priority:this.calculatePriority(e),nodeId:e.id,depth:n}),o.appliedRules.length>0&&console.log(`üéØ Aplicadas ${o.appliedRules.length} regras ao componente "${e.name}"`);return}if(e.type==="COMPONENT"){let s=!1;o.classification?s=o.classification==="connected":s=!1,console.log(`üß© COMPONENT "${e.name}": ‚Üí ${s?"CONECTADO":"DESCONECTADO"}`),t.push({name:e.name,type:"COMPONENT",isConnectedToDS:s,priority:this.calculatePriority(e),nodeId:e.id,depth:n}),o.appliedRules.length>0&&console.log(`üéØ Aplicadas ${o.appliedRules.length} regras ao componente "${e.name}"`);return}if(e.type==="TEXT"){let s=!1,a="disconnected";if(o.shouldInclude)s=!0,a=o.classification||"disconnected",console.log(`‚úÖ Texto inclu√≠do por regra aprendida: "${e.name}" ‚Üí ${a.toUpperCase()}`);else if(s=this.shouldIncludeTextComponent(e,n),s){const i=this.isTextUsingDesignSystemTokens(e);a=i?"connected":"disconnected",console.log(`üìù Texto auto-detectado: "${e.name}" (depth: ${n}) ‚Üí ${a.toUpperCase()} (tokens: ${i})`)}if(s){t.push({name:e.name,type:"TEXT",isConnectedToDS:a==="connected",priority:this.calculatePriority(e),nodeId:e.id,depth:n});return}}if(o.shouldInclude&&(e.type==="RECTANGLE"||e.type==="ELLIPSE"||e.type==="VECTOR")){const s=o.classification||"disconnected";console.log(`‚úÖ Inclu√≠do elemento "${e.name}" (${e.type}) devido a regra aprendida ‚Üí ${s.toUpperCase()}`),t.push({name:e.name,type:"OTHER",isConnectedToDS:s==="connected",priority:this.calculatePriority(e),nodeId:e.id,depth:n})}else this.shouldIncludeAsDisconnectedComponent(e,n)?(console.log(`üî∂ Auto-detectado como componente: "${e.name}" (${e.type})`),t.push({name:e.name,type:"OTHER",isConnectedToDS:!1,priority:this.calculatePriority(e),nodeId:e.id,depth:n})):this.shouldShowAsOption(e,n)&&(console.log(`üìã Adicionado como op√ß√£o: "${e.name}" (${e.type}) - usu√°rio decide`),t.push({name:e.name,type:"OTHER",isConnectedToDS:!1,priority:this.calculatePriority(e),nodeId:e.id,depth:n}));e.children&&e.children.forEach(s=>{this.extractComponents(s,t,n+1)})}static filterRelevantComponents(e){console.log(`üîç Mostrando TODOS os componentes: ${e.length} componentes encontrados`);const t=e.filter(n=>(console.log(`‚úÖ Incluindo componente: "${n.name}" (${n.type})`),!0));return console.log(`üìä Todos os componentes inclu√≠dos: ${t.length} componentes na an√°lise`),t}static shouldIncludeAsDisconnectedComponent(e,t){if(t>4||!["RECTANGLE","ELLIPSE","VECTOR","FRAME","GROUP"].includes(e.type))return!1;if(e.absoluteBoundingBox){const{width:i,height:r}=e.absoluteBoundingBox;if(i<20||r<20||i>500||r>500)return!1}const s=[/button/i,/btn/i,/card/i,/modal/i,/popup/i,/tooltip/i,/input/i,/field/i,/form/i,/checkbox/i,/radio/i,/icon/i,/avatar/i,/badge/i,/chip/i,/tag/i,/header/i,/footer/i,/sidebar/i,/menu/i,/nav/i,/component/i,/element/i,/widget/i,/rectangle \d+/i,/ellipse \d+/i,/vector \d+/i].some(i=>i.test(e.name)),a=!!(e.children&&e.children.length>0);return s||a&&t<=2}static shouldShowAsOption(e,t){if(t>5||!["TEXT","RECTANGLE","ELLIPSE","VECTOR","FRAME","GROUP","LINE"].includes(e.type)||e.name.startsWith("_"))return!1;if(e.absoluteBoundingBox){const{width:o,height:s}=e.absoluteBoundingBox;if(o<5||s<5)return!1}return console.log(`üìã Considerando elemento como op√ß√£o: "${e.name}" (${e.type}, depth: ${t})`),!0}static isTextUsingDesignSystemTokens(e){console.log(`üîç DEBUG: Propriedades completas do n√≥ TEXT "${e.name}":`,e);try{console.log("üìã textStyleId:",e.textStyleId),console.log("üìã fillStyleId:",e.fillStyleId),console.log("üìã styles (API REST):",e.styles),console.log("üìã fills (length):",e.fills?e.fills.length:"undefined"),console.log("üìã fills (content):",e.fills),console.log("üìã boundVariables:",e.boundVariables),console.log("üìã Todas as propriedades:",Object.keys(e));const s=["textStyleId","fillStyleId","style","styles","textStyle","fillStyle","styleId","textStyles","fillStyles","boundVariables","variables"];console.log("üìã Propriedades de estilo encontradas:"),s.forEach(a=>{e.hasOwnProperty(a)&&console.log(`   - ${a}:`,e[a])})}catch(s){console.log("‚ùå Erro ao logar propriedades:",s)}let t=!1,n=!1;if(e.textStyleId&&e.textStyleId.trim()!==""&&(console.log(`üìù Texto "${e.name}" tem textStyleId: ${e.textStyleId}`),t=!0),e.styles&&e.styles.text&&e.styles.text.trim()!==""&&(console.log(`üìù Texto "${e.name}" tem styles.text: ${e.styles.text}`),t=!0),e.boundVariables&&Object.keys(e.boundVariables).length>0){const s=["fontFamily","fontSize","fontWeight","lineHeight","letterSpacing"];s.some(i=>e.boundVariables&&e.boundVariables[i])&&(console.log(`üìù Texto "${e.name}" tem vari√°veis de texto:`,Object.keys(e.boundVariables).filter(i=>s.includes(i))),t=!0)}if(e.fillStyleId&&e.fillStyleId.trim()!==""&&(console.log(`üé® Texto "${e.name}" tem fillStyleId: ${e.fillStyleId}`),n=!0),e.styles&&e.styles.fill&&e.styles.fill.trim()!==""&&(console.log(`üé® Texto "${e.name}" tem styles.fill: ${e.styles.fill}`),n=!0),e.fills&&Array.isArray(e.fills)&&(console.log(`üîç Analisando ${e.fills.length} fills...`),e.fills.some(i=>i.boundVariables&&Object.keys(i.boundVariables).length>0)&&(console.log(`üé® Texto "${e.name}" tem fills com vari√°veis:`,e.fills.filter(i=>i.boundVariables)),n=!0),e.fills.some(i=>i.styleId||i.fillStyleId)&&(console.log(`üé® Texto "${e.name}" tem fills com styleId`),n=!0)),e.boundVariables&&Object.keys(e.boundVariables).length>0){const s=["fills","strokes","textRangeFills"];s.some(i=>e.boundVariables&&e.boundVariables[i])&&(console.log(`üé® Texto "${e.name}" tem vari√°veis de cor:`,Object.keys(e.boundVariables).filter(i=>s.includes(i))),n=!0)}!n&&e.fills&&Array.isArray(e.fills)&&e.fills.length>0&&console.log("üîç Verificando fills para cores do sistema...");const o=t&&n;return o?console.log(`‚úÖ Texto "${e.name}" CONECTADO - tem texto token (${t}) E cor token (${n})`):(console.log(`‚ùå Texto "${e.name}" DESCONECTADO - texto token: ${t}, cor token: ${n}`),t||console.log("   ‚ö†Ô∏è Faltando: token de texto (textStyleId/styles.text ou vari√°veis de tipografia)"),n||console.log("   ‚ö†Ô∏è Faltando: token de cor (fillStyleId/styles.fill ou vari√°veis de cor)")),o}static shouldIncludeTextComponent(e,t){if(t>6)return console.log(`üö´ Texto muito profundo: "${e.name}" (depth: ${t})`),!1;if(e.absoluteBoundingBox){const{width:i,height:r}=e.absoluteBoundingBox;if(i<5||r<5)return console.log(`üö´ Texto muito pequeno: "${e.name}" (${i}x${r}px)`),!1;if(i>1200||r>400)return console.log(`üö´ Texto muito grande: "${e.name}" (${i}x${r}px)`),!1}return[/component/i,/element/i,/widget/i,/title/i,/heading/i,/header/i,/label/i,/caption/i,/subtitle/i,/button/i,/link/i,/menu/i,/nav/i,/tab/i,/capa/i,/teste/i,/demo/i,/example/i,/sample/i,/text \d+/i,/texto \d+/i,/main/i,/primary/i,/secondary/i,/content/i].some(i=>i.test(e.name))?(console.log(`‚úÖ Texto inclu√≠do por padr√£o de nome: "${e.name}"`),!0):[/^placeholder$/i,/^lorem ipsum$/i,/^sample text$/i,/^text$/i,/^label$/i,/^caption$/i].some(i=>i.test(e.name)&&i.test(e.name.trim())&&e.name.trim().length<15)?(console.log(`üö´ Texto exclu√≠do por ser placeholder/decorativo: "${e.name}"`),!1):(console.log(`üìù Texto inclu√≠do por crit√©rios gerais: "${e.name}" (depth: ${t})`),!0)}static calculatePriority(e){return e.type==="INSTANCE"?1:e.type==="COMPONENT"?2:3}static categorizeComponents(e){const t={connected:[],disconnected:[]};return e.forEach(n=>{n.isConnectedToDS?t.connected.push(n):t.disconnected.push(n)}),t}static getSuggestedMissedComponents(e){const t=[],n=(s,a)=>{a>0&&!s.name.startsWith("_")&&(s.type==="RECTANGLE"||s.type==="ELLIPSE"||s.type==="VECTOR")&&s.absoluteBoundingBox&&s.absoluteBoundingBox.width>10&&s.absoluteBoundingBox.height>10&&t.push({name:s.name,type:s.type,nodeId:s.id}),s.children&&s.type!=="INSTANCE"&&s.children.forEach(i=>n(i,a+1))};return n(e,0),t.filter((s,a,i)=>a===i.findIndex(r=>r.name===s.name)).slice(0,10)}}const S=class S{static isAuthenticated(){const e=this.getAuthData();return e?Date.now()>e.expiresAt?(this.logout(),!1):!0:!1}static login(e,t){const n=this.VALID_USERS[e];if(!n||n!==t)return!1;const o={email:e,loginTime:Date.now(),expiresAt:Date.now()+this.SESSION_DURATION};return localStorage.setItem(this.STORAGE_KEY,JSON.stringify(o)),!0}static logout(){localStorage.removeItem(this.STORAGE_KEY)}static getAuthData(){try{const e=localStorage.getItem(this.STORAGE_KEY);return e?JSON.parse(e):null}catch{return null}}static getCurrentUser(){const e=this.getAuthData();return(e==null?void 0:e.email)||null}static shouldRenewSession(){const e=this.getAuthData();if(!e)return!1;const t=e.expiresAt-Date.now(),n=60*60*1e3;return t<n}static renewSession(){const e=this.getAuthData();e&&(e.expiresAt=Date.now()+this.SESSION_DURATION,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(e)))}};S.STORAGE_KEY="figma-analyzer-auth",S.SESSION_DURATION=24*60*60*1e3,S.VALID_USERS={"design@qive.com":"design2024","ux@qive.com":"ux2024","admin@qive.com":"admin2024","rafael@qive.com":"dev2024"};let E=S;const A={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},R=y=>(A==null?void 0:A[y])||"",$={googleSheetsApiKey:R("VITE_GOOGLE_SHEETS_API_KEY"),googleSheetsId:R("VITE_GOOGLE_SHEETS_ID"),googleScriptUrl:R("VITE_GOOGLE_SCRIPT_URL")};class P{static get GOOGLE_SHEETS_ID(){return $.googleSheetsId}static get GOOGLE_SHEETS_API_KEY(){return $.googleSheetsApiKey}static get GOOGLE_SCRIPT_URL(){return $.googleScriptUrl}}const D=class D{static async sendFeedback(e){if(console.log("üîç DEBUG - SCRIPT_URL:",this.SCRIPT_URL),console.log("üîç DEBUG - SCRIPT_URL existe:",!!this.SCRIPT_URL),!this.SCRIPT_URL||this.SCRIPT_URL==="")return console.warn("‚ö†Ô∏è Google Apps Script URL n√£o configurada. Salvando apenas localmente."),!1;try{const t={...e,timestamp:e.timestamp||new Date().toISOString(),userAgent:e.userAgent||navigator.userAgent};console.log("üì§ Enviando feedback via Google Apps Script:",t);const n=await fetch(this.SCRIPT_URL,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const o=await n.json();if(o.success)return console.log("‚úÖ Feedback enviado com sucesso para Google Sheets!"),!0;throw new Error(o.error||"Erro desconhecido do Google Apps Script")}catch(t){return console.error("‚ùå Erro ao enviar para Google Sheets:",t),!1}}static async syncPendingFeedbacks(){const e="compcount_pending_feedbacks",t=localStorage.getItem(e);if(t)try{const n=JSON.parse(t);if(n.length===0)return;console.log(`üîÑ Tentando sincronizar ${n.length} feedbacks pendentes...`);const o=await Promise.allSettled(n.map(a=>this.sendFeedback(a))),s=[];if(o.forEach((a,i)=>{a.status==="fulfilled"&&a.value===!0&&s.push(i)}),s.length>0){const a=n.filter((i,r)=>!s.includes(r));a.length===0?(localStorage.removeItem(e),console.log("üéâ Todos os feedbacks pendentes foram sincronizados!")):(localStorage.setItem(e,JSON.stringify(a)),console.log(`‚è≥ ${a.length} feedbacks ainda pendentes de sincroniza√ß√£o`))}else console.log(`‚è≥ ${n.length} feedbacks ainda pendentes de sincroniza√ß√£o`)}catch(n){console.error("‚ùå Erro ao sincronizar feedbacks pendentes:",n)}}static saveFeedbackLocally(e){const t="compcount_pending_feedbacks",n=localStorage.getItem(t);let o=[];if(n)try{o=JSON.parse(n)}catch(s){console.error("Erro ao carregar feedbacks pendentes:",s)}o.push({...e,timestamp:e.timestamp||new Date().toISOString(),userAgent:e.userAgent||navigator.userAgent}),localStorage.setItem(t,JSON.stringify(o)),console.log("üíæ Feedback salvo localmente para sincroniza√ß√£o posterior")}static async processFeedback(e){await this.sendFeedback(e)||this.saveFeedbackLocally(e)}};D.SCRIPT_URL=P.GOOGLE_SCRIPT_URL;let k=D;class U{constructor(){this.chartManager=null,this.currentAnalysisResult=null}setChartManager(e){this.chartManager=e}updateSummaryCards(e){const t=document.querySelectorAll(".summary-card");if(t.length>=3){const i=t[0].querySelector(".summary-value");i&&(i.textContent="0");const r=t[1].querySelector(".summary-value");r&&(r.textContent="0");const c=t[2].querySelector(".summary-value");c&&(c.textContent="0")}const n=document.getElementById("connected-count");n&&(n.textContent="0");const o=document.getElementById("disconnected-count");o&&(o.textContent="0");const s=document.getElementById("compliance-rate"),a=document.getElementById("compliance-status");s&&a&&(s.textContent="0%",a.textContent="Aguardando...",a.className="px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800",a.classList.remove("hidden")),console.log("üìä Cards de resumo inicializados com zeros - aguardando c√°lculo dos toggles")}updateComponentsTable(e){const t=document.getElementById("components-table-body");if(!t)return;const n=B.categorizeComponents(e.components);t.innerHTML="",n.connected.forEach(o=>{const s=this.createComponentRow(o,!0,e.frameInfo.url);t.appendChild(s)}),n.disconnected.forEach(o=>{const s=this.createComponentRow(o,!1,e.frameInfo.url);t.appendChild(s)}),this.setupToggleListeners(),setTimeout(()=>{this.recalculateStats(),console.log("üìä Estat√≠sticas recalculadas automaticamente ap√≥s configurar toggles")},100)}createComponentRow(e,t,n){const o=document.createElement("tr");o.className="border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700";const s=t?'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200">Conectado</span>':'<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200">Desconectado</span>',a=this.hasDesignSystemLikeName(e.name),i=e.type==="INSTANCE"||e.type==="COMPONENT"||a,l=`
      <label class="relative inline-flex items-center cursor-pointer justify-center">
        <input type="checkbox" id="${`toggle-${e.nodeId.replace(":","-")}`}" class="sr-only peer component-toggle" ${i?"checked":""} data-node-id="${e.nodeId}">
        <div class="w-11 h-6 bg-gray-200 dark:bg-gray-600 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-red-300 dark:peer-focus:ring-red-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 dark:after:border-gray-500 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-red-600 dark:peer-checked:bg-red-600"></div>
      </label>
    `,g=e.type==="INSTANCE"?"INSTANCE":e.type==="COMPONENT"?"COMPONENT":a?"NOME_DS":"OUTROS";console.log(`üîò Toggle para "${e.name}" (${e.type}): ${i?"LIGADO":"DESLIGADO"} por padr√£o (motivo: ${g})`);const p=this.createFigmaElementUrl(n,e.nodeId),h=p?`<a href="${p}" target="_blank" class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 underline font-mono text-sm" title="Abrir elemento no Figma">${e.nodeId} üîó</a>`:`<span class="font-mono text-sm text-gray-500 dark:text-gray-400">${e.nodeId}</span>`;return o.innerHTML=`
      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white">
        ${e.name}
      </td>
      <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400">
        ${e.type}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        ${s}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        ${h}
      </td>
      <td class="px-6 py-4 whitespace-nowrap">
        ${l}
      </td>
    `,o}createFigmaElementUrl(e,t){try{const n=new URL(e),o=t.replace(":","-");return n.searchParams.set("node-id",o),n.toString()}catch(n){return console.error("Erro ao criar URL do elemento Figma:",n),null}}setupToggleListeners(){document.querySelectorAll(".component-toggle").forEach(t=>{t.addEventListener("change",()=>{this.recalculateStats()})})}recalculateStats(){const e=document.querySelectorAll(".component-toggle");let t=0,n=0;console.log(`üîÑ Recalculando estat√≠sticas... ${e.length} toggles encontrados`),e.forEach(o=>{if(!o.checked){console.log(`‚è≠Ô∏è Toggle desabilitado para nodeId: ${o.dataset.nodeId}`);return}const s=o.closest("tr");if(!s){console.log(`‚ùå Linha n√£o encontrada para toggle: ${o.dataset.nodeId}`);return}const a=s.querySelectorAll("span");let i=!1;a.forEach(r=>{var c;(c=r.textContent)!=null&&c.includes("Conectado")&&(i=!0)}),i?(t++,console.log(`‚úÖ Componente conectado contabilizado: ${o.dataset.nodeId}`)):(n++,console.log(`‚ùå Componente desconectado contabilizado: ${o.dataset.nodeId}`))}),console.log(`üìä Resultado final: ${t} conectados, ${n} desconectados`),this.updateSummaryCardsWithCustomValues(t,n),this.updateAnalysisSummary(t,n),this.chartManager&&this.chartManager.updatePieChartWithValues(t,n)}updateSummaryCardsWithCustomValues(e,t){const n=document.querySelectorAll(".summary-card .summary-value");n.length>=3&&(n[0].textContent=e.toString(),n[1].textContent=t.toString(),n[2].textContent=(e+t).toString())}updateAnalysisSummary(e,t){const n=document.getElementById("connected-count"),o=document.getElementById("disconnected-count"),s=document.getElementById("compliance-rate"),a=document.getElementById("compliance-status");if(n&&(n.textContent=e.toString()),o&&(o.textContent=t.toString()),s&&a){const i=e+t,r=i>0?Math.round(e/i*100):0;s.textContent=`${r}%`,r>=80?(a.textContent="Aprovado",a.className="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800"):(a.textContent="Revisar",a.className="px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800"),a.classList.remove("hidden")}console.log(`üìä Resumo da An√°lise atualizado: ${e} conectados, ${t} desconectados`)}toggleLoadingState(e){const t=document.getElementById("analysis-status");t&&t.classList.toggle("hidden",!e)}toggleReportDropdown(e){const t=document.getElementById("report-dropdown");t&&t.classList.toggle("hidden",!e)}setupReportDropdown(){const e=document.getElementById("generate-report-btn"),t=document.getElementById("report-dropdown-menu");!e||!t||(e.addEventListener("click",n=>{n.stopPropagation();const o=!t.classList.contains("hidden");t.classList.toggle("hidden",o),e.setAttribute("aria-expanded",(!o).toString())}),document.addEventListener("click",()=>{t.classList.add("hidden"),e.setAttribute("aria-expanded","false")}),this.setupReportOptions())}setupReportOptions(){const e=document.getElementById("export-png");e&&e.addEventListener("click",()=>this.showWipMessage("PNG"));const t=document.getElementById("export-pdf");t&&t.addEventListener("click",()=>this.showWipMessage("PDF"));const n=document.getElementById("generate-link");n&&n.addEventListener("click",()=>this.generateShareableLink());const o=document.getElementById("export-checklist");o&&o.addEventListener("click",()=>this.showWipMessage("Checklist"))}showWipMessage(e){this.showError(`üöß ${e} em desenvolvimento! Use "Gerar Link" por enquanto.`)}generateShareableLink(){var e,t,n,o,s,a,i,r;try{if(!this.currentAnalysisResult){this.showError("Nenhuma an√°lise dispon√≠vel para compartilhar");return}const c=((e=document.getElementById("connected-count"))==null?void 0:e.textContent)||"0",l=((t=document.getElementById("disconnected-count"))==null?void 0:t.textContent)||"0",g=((n=document.getElementById("compliance-rate"))==null?void 0:n.textContent)||"0%",p=((o=document.getElementById("compliance-status"))==null?void 0:o.textContent)||"",h=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x=this.getExcludedComponents(),u={frameInfo:this.currentAnalysisResult.frameInfo,summary:this.currentAnalysisResult.summary,components:this.currentAnalysisResult.components,excludedComponents:x,timestamp:Date.now(),complianceRate:parseFloat(g.replace("%","")),complianceStatus:p,analysisId:h},w=`shared-analysis-${h}`,b=JSON.stringify(u);try{localStorage.setItem(w,b),console.log("‚úÖ Dados salvos no localStorage com chave:",w),sessionStorage.setItem(w,b),console.log("‚úÖ Dados salvos no sessionStorage como backup");const d=`shared-analysis-${Date.now()}`;localStorage.setItem(d,b),console.log("‚úÖ Dados salvos com chave alternativa:",d),console.log("üìä Dados completos sendo salvos:",{frameInfo:u.frameInfo,totalComponents:((s=u.components)==null?void 0:s.length)||0,componentNames:((a=u.components)==null?void 0:a.slice(0,3).map(T=>T.name))||[],excludedComponents:((i=u.excludedComponents)==null?void 0:i.length)||0})}catch(d){console.error("‚ùå Erro ao salvar dados:",d),this.showError("Erro ao salvar dados da an√°lise");return}const N={frameInfo:u.frameInfo,components:u.components.map(d=>({name:d.name,type:d.type,isConnectedToDS:d.isConnectedToDS,nodeId:d.nodeId})),excludedComponents:((r=u.excludedComponents)==null?void 0:r.map(d=>({name:d.name,type:d.type,isConnectedToDS:d.isConnectedToDS,nodeId:d.nodeId})))||[],summary:u.summary,complianceRate:u.complianceRate,complianceStatus:u.complianceStatus,timestamp:u.timestamp},v=JSON.stringify(N);console.log("üì¶ Dados compactos:",{originalSize:b.length,compactSize:v.length,reduction:Math.round((1-v.length/b.length)*100)+"%"});let f="",C=!1;try{const d=encodeURIComponent(btoa(v));f=`${new URL(window.location.href).origin}/view.html?shared=true&id=${h}&data=${d}&connected=${c}&disconnected=${l}&compliance=${encodeURIComponent(g)}&status=${encodeURIComponent(p)}&timestamp=${Date.now()}`,C=!0,console.log("‚úÖ URL com dados completos criada (tamanho:",f.length,"chars)"),console.log("üîó URL preview:",f.substring(0,150)+"...")}catch(d){console.error("‚ùå Erro ao codificar dados:",d),f=`${new URL(window.location.href).origin}/view.html?shared=true&id=${h}&connected=${c}&disconnected=${l}&compliance=${encodeURIComponent(g)}&status=${encodeURIComponent(p)}&timestamp=${Date.now()}`,C=!1,console.log("‚ö†Ô∏è Fallback: URL sem dados codificados")}navigator.clipboard.writeText(f).then(()=>{this.showSuccess("üîó Link da an√°lise copiado! Compartilhe com sua equipe.")}).catch(()=>{const d=document.createElement("textarea");d.value=f,document.body.appendChild(d),d.select(),document.execCommand("copy"),document.body.removeChild(d),this.showSuccess("üîó Link da an√°lise copiado!")}),console.log("üìä Link gerado com dados completos:",{analysisId:h,connected:c,disconnected:l,compliance:g,status:p,url:f,fullDataSaved:!0,dataIncluded:C,urlLength:f.length})}catch(c){console.error("Erro ao gerar link:",c),this.showError("Erro ao gerar link compartilh√°vel")}}setCurrentAnalysisResult(e){this.currentAnalysisResult=e}getExcludedComponents(){const e=[];if(!this.currentAnalysisResult)return e;try{document.querySelectorAll(".component-toggle").forEach(n=>{if(!n.checked){const o=n.dataset.nodeId,s=this.currentAnalysisResult.components.find(a=>a.nodeId===o);s&&e.push(s)}})}catch(t){console.warn("Erro ao coletar componentes exclu√≠dos:",t)}return e}toggleFeedbackButton(e){const t=document.getElementById("show-feedback-form");t&&t.classList.toggle("hidden",!e)}toggleAnalysisSections(e){const t=document.getElementById("summary-cards"),n=document.getElementById("charts-analysis"),o=document.getElementById("components-table");t&&t.classList.toggle("hidden",!e),n&&n.classList.toggle("hidden",!e),o&&o.classList.toggle("hidden",!e)}updatePatternsCount(){const e=m.getPatterns(),t=document.getElementById("patterns-count-modal");t&&(t.textContent=`${e.length}`)}toggleDetailedFeedback(e){const t=document.getElementById("feedback-drawer"),n=document.getElementById("feedback-drawer-content");t&&n&&(e?(t.classList.remove("hidden"),t.offsetHeight,n.classList.remove("translate-x-full")):(n.classList.add("translate-x-full"),setTimeout(()=>{t.classList.add("hidden")},300)))}setupFeedbackForm(){const e=document.getElementById("feedback-type"),t=document.getElementById("component-name-field"),n=document.getElementById("expected-classification-field");e&&e.addEventListener("change",()=>{const o=e.value;t&&t.classList.toggle("hidden",o!=="missed_component"&&o!=="wrong_classification"&&o!=="should_ignore"),n&&n.classList.toggle("hidden",o!=="missed_component"&&o!=="wrong_classification")})}showSuggestedComponents(e){const t=document.getElementById("suggested-components"),n=document.getElementById("suggestions-list");if(!(!t||!n)){if(e.length===0){t.classList.add("hidden");return}t.classList.remove("hidden"),n.innerHTML="",e.forEach(o=>{const s=document.createElement("div");s.className="flex items-center justify-between p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100",s.innerHTML=`
        <div class="flex-1">
          <span class="text-sm font-medium text-gray-900">${o.name}</span>
          <span class="ml-2 text-xs text-gray-500">(${o.type})</span>
        </div>
        <button class="text-xs text-red-600 hover:text-red-800 font-medium">
          Usar este
        </button>
      `,s.addEventListener("click",()=>{const a=document.getElementById("component-name"),i=document.getElementById("feedback-type");a&&(a.value=o.name),i&&(i.value="missed_component",i.dispatchEvent(new Event("change")))}),n.appendChild(s)})}}updateLearningStats(){const e=m.getLearningStats(),t=document.getElementById("learning-stats");t&&(t.textContent=`${e.totalPatterns} padr√µes ‚Ä¢ ${e.totalFeedbacks} feedbacks ‚Ä¢ ${e.totalRules} regras ativas`)}clearFeedbackForm(){const e=document.getElementById("detailed-feedback");if(!e)return;const t=e.querySelector("#feedback-type"),n=e.querySelector("#component-name"),o=e.querySelector("#expected-classification"),s=e.querySelector("#feedback-description");t&&(t.value=""),n&&(n.value=""),o&&(o.value=""),s&&(s.value="");const a=document.getElementById("component-name-field"),i=document.getElementById("expected-classification-field");a&&a.classList.add("hidden"),i&&i.classList.add("hidden")}collectFeedbackData(){const e=document.getElementById("feedback-type"),t=document.getElementById("component-name"),n=document.getElementById("expected-classification"),o=document.getElementById("feedback-description");if(!e||!o)return null;const s=e.value,a=o.value.trim();if(!s||!a)return this.showError("Por favor, preencha o tipo e a descri√ß√£o do problema"),null;const i={type:s,description:a,timestamp:Date.now()};return t&&t.value.trim()&&(i.componentName=t.value.trim()),n&&n.value&&(i.expectedClassification=n.value),i}showError(e){this.showSnackbar(e,"error")}showSuccess(e){this.showSnackbar(e,"success")}showSnackbar(e,t){const n=document.getElementById("snackbar-container");if(!n)return;const o=document.createElement("div"),s=`snackbar-${Date.now()}`;o.id=s;const a="pointer-events-auto mb-3 px-4 py-3 rounded-lg shadow-lg border flex items-center min-w-96 max-w-md mx-auto transition-all duration-300 ease-out transform",i=t==="success"?"bg-green-50 border-green-200 text-green-800":"bg-red-50 border-red-200 text-red-800";o.className=`${a} ${i} translate-y-0 opacity-100`;const r=t==="success"?`<svg class="w-5 h-5 text-green-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
           <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
         </svg>`:`<svg class="w-5 h-5 text-red-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
           <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
         </svg>`;o.innerHTML=`
      <div class="flex items-center w-full">
        ${r}
        <div class="ml-3 flex-1">
          <p class="text-sm font-medium">${e}</p>
        </div>
        <button 
          class="ml-3 flex-shrink-0 text-gray-400 hover:text-gray-600 transition-colors"
          onclick="this.closest('[id^=snackbar-]').remove()"
          aria-label="Fechar"
        >
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
        </button>
      </div>
    `,o.style.transform="translateY(-20px)",o.style.opacity="0",n.appendChild(o),requestAnimationFrame(()=>{o.style.transform="translateY(0)",o.style.opacity="1"}),setTimeout(()=>{this.hideSnackbar(s)},4e3)}hideSnackbar(e){const t=document.getElementById(e);t&&(t.style.transform="translateY(-20px)",t.style.opacity="0",setTimeout(()=>{t.parentNode&&t.remove()},300))}hasDesignSystemLikeName(e){return[/button/i,/btn/i,/botao/i,/bot√£o/i,/card/i,/cartao/i,/cart√£o/i,/modal/i,/popup/i,/dialog/i,/overlay/i,/tooltip/i,/popover/i,/dropdown/i,/input/i,/field/i,/form/i,/campo/i,/checkbox/i,/radio/i,/switch/i,/toggle/i,/select/i,/option/i,/picker/i,/textarea/i,/textfield/i,/menu/i,/nav/i,/navigation/i,/navbar/i,/breadcrumb/i,/tab/i,/aba/i,/guia/i,/sidebar/i,/drawer/i,/header/i,/footer/i,/alert/i,/notification/i,/toast/i,/snackbar/i,/badge/i,/tag/i,/chip/i,/pill/i,/loading/i,/spinner/i,/skeleton/i,/avatar/i,/profile/i,/image/i,/icon/i,/list/i,/item/i,/grid/i,/table/i,/accordion/i,/collapse/i,/panel/i,/component/i,/elemento/i,/widget/i,/design.?system/i,/ds.?/i,/ui.?kit/i,/template/i,/layout/i,/container/i,/^(base|primary|secondary)/i,/\/(button|card|modal|input)/i,/button$/i,/card$/i,/modal$/i,/label/i,/title/i,/heading/i,/caption/i,/link/i,/texto/i,/text/i,/capa/i,/teste/i,/demo/i,/example/i].some(o=>o.test(e))?(console.log(`üéØ Nome "${e}" identificado como Design System - toggle ser√° LIGADO por padr√£o`),!0):!1}}class O{constructor(){this.currentResult=null,this.currentFrameNode=null,this.chartManager=new F,this.uiManager=new U,new M,this.uiManager.setChartManager(this.chartManager),this.checkAuthAndInit()}checkAuthAndInit(){E.isAuthenticated()?(this.showMainApp(),this.init()):this.showLoginScreen()}showLoginScreen(){const e=document.getElementById("login-screen"),t=document.getElementById("main-app");e&&e.classList.remove("hidden"),t&&t.classList.add("hidden"),this.setupLoginListeners()}showMainApp(){const e=document.getElementById("login-screen"),t=document.getElementById("main-app");e&&e.classList.add("hidden"),t&&t.classList.remove("hidden")}setupLoginListeners(){const e=document.getElementById("login-form");e&&e.addEventListener("submit",t=>this.handleLogin(t))}handleLogin(e){e.preventDefault();const t=document.getElementById("login-email"),n=document.getElementById("login-password");if(!t||!n)return;const o=t.value.trim(),s=n.value.trim();E.login(o,s)?(this.showMainApp(),this.init()):this.showLoginError("Email ou senha incorretos")}showLoginError(e){const t=document.querySelector(".login-error");t&&t.remove();const n=document.createElement("div");n.className="login-error bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-md p-3 mt-4",n.innerHTML=`
      <div class="flex">
        <svg class="h-5 w-5 text-red-400 dark:text-red-300 mr-2" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
        </svg>
        <p class="text-sm text-red-700 dark:text-red-300">${e}</p>
      </div>
    `;const o=document.getElementById("login-form");o&&o.appendChild(n)}async init(){console.log("üöÄ Iniciando Figma Component Analyzer..."),m.initializeKnownPatterns(),this.loadSavedToken(),this.uiManager.updatePatternsCount(),this.uiManager.setupFeedbackForm(),this.uiManager.updateLearningStats(),this.syncPendingFeedbacks(),this.setupEventListeners()}async syncPendingFeedbacks(){try{await k.syncPendingFeedbacks()}catch(e){console.error("Erro na sincroniza√ß√£o autom√°tica:",e)}}setupEventListeners(){const e=document.querySelector('[onclick="analyzeFrame()"]');e&&(e.removeAttribute("onclick"),e.addEventListener("click",()=>this.analyzeFrame()));const t=document.getElementById("toggle-token-visibility");t&&t.addEventListener("click",()=>this.toggleTokenVisibility()),this.uiManager.setupReportDropdown();const n=document.getElementById("show-feedback-form");n&&n.addEventListener("click",()=>this.showFeedbackForm());const o=document.getElementById("cancel-feedback");o&&o.addEventListener("click",()=>this.cancelFeedback());const s=document.getElementById("submit-feedback");s&&s.addEventListener("click",()=>this.submitFeedback());const a=document.getElementById("figma-token");a&&a.addEventListener("input",()=>{const u=a.value.trim();u&&m.saveToken(u)});const i=document.getElementById("show-instructions"),r=document.getElementById("instructions-modal"),c=document.getElementById("close-instructions"),l=document.getElementById("close-instructions-btn");i&&r&&i.addEventListener("click",()=>{r.classList.remove("hidden")}),c&&r&&c.addEventListener("click",()=>{r.classList.add("hidden")}),l&&r&&l.addEventListener("click",()=>{r.classList.add("hidden")}),r&&r.addEventListener("click",u=>{u.target===r&&r.classList.add("hidden")});const g=document.getElementById("close-feedback-drawer"),p=document.getElementById("feedback-overlay");g&&g.addEventListener("click",()=>this.cancelFeedback()),p&&p.addEventListener("click",()=>this.cancelFeedback());const h=document.getElementById("export-learning-data");h&&h.addEventListener("click",()=>this.exportLearningData());const x=document.getElementById("logout-btn");x&&x.addEventListener("click",()=>this.handleLogout())}handleLogout(){E.logout(),this.currentResult=null,this.currentFrameNode=null,this.uiManager.toggleAnalysisSections(!1),this.uiManager.toggleReportDropdown(!1),this.uiManager.toggleFeedbackButton(!1),this.showLoginScreen()}loadSavedToken(){const e=m.getToken();if(e){const t=document.getElementById("figma-token");t&&(t.value=e)}}toggleTokenVisibility(){const e=document.getElementById("figma-token"),t=document.getElementById("eye-icon");if(e&&t){const n=e.type==="password";e.type=n?"text":"password",t.innerHTML=n?'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>':'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>'}}async analyzeFrame(){const e=document.getElementById("figma-token"),t=document.getElementById("figma-url");if(!e||!t){this.uiManager.showError("Elementos de entrada n√£o encontrados");return}const n=e.value.trim(),o=t.value.trim();if(!n){this.uiManager.showError("Token do Figma √© obrigat√≥rio");return}if(!o){this.uiManager.showError("URL do frame √© obrigat√≥ria");return}this.uiManager.toggleLoadingState(!0);try{const s=L.parseUrl(o);if(!s)throw new Error("URL do Figma inv√°lida");const a=new L(n);if(!await a.validateToken())throw new Error("Token do Figma inv√°lido ou sem permiss√µes");const r=await a.fetchFrame(s.fileKey,s.nodeId);if(!r)throw new Error("Frame n√£o encontrado");const c=B.analyzeFrame(r,o),l=m.getPatternByFrameId(s.nodeId);l&&(console.log("Padr√£o conhecido encontrado:",l),l.corrections&&(c.summary.connected=l.corrections.connected,c.summary.disconnected=l.corrections.disconnected,c.summary.total=l.corrections.connected+l.corrections.disconnected)),this.currentResult=c,this.currentFrameNode=r,this.uiManager.setCurrentAnalysisResult(c),this.updateUI(c),this.uiManager.toggleAnalysisSections(!0),this.uiManager.toggleReportDropdown(!0),this.uiManager.toggleFeedbackButton(!0),this.uiManager.showSuccess("An√°lise conclu√≠da com sucesso!")}catch(s){console.error("Erro na an√°lise:",s),this.uiManager.showError(s instanceof Error?s.message:"Erro desconhecido na an√°lise")}finally{this.uiManager.toggleLoadingState(!1)}}updateUI(e){this.uiManager.updateSummaryCards(e),this.uiManager.updateComponentsTable(e),this.chartManager.updatePieChart(e)}exportLearningData(){try{m.exportAllLearningData(),this.uiManager.showSuccess("Dados exportados! Envie o arquivo para consolida√ß√£o.")}catch(e){console.error("Erro ao exportar dados:",e),this.uiManager.showError("Erro ao exportar dados de aprendizado")}}showFeedbackForm(){if(!this.currentResult||!this.currentFrameNode){this.uiManager.showError("Nenhuma an√°lise ativa para dar feedback");return}this.uiManager.toggleDetailedFeedback(!0);const e=B.getSuggestedMissedComponents(this.currentFrameNode);this.uiManager.showSuggestedComponents(e),this.uiManager.updateLearningStats()}cancelFeedback(){this.uiManager.toggleDetailedFeedback(!1),this.uiManager.clearFeedbackForm()}async submitFeedback(){if(!this.currentResult){this.uiManager.showError("Nenhuma an√°lise ativa para dar feedback");return}const e=this.uiManager.collectFeedbackData();if(!e)return;const t=document.getElementById("submit-feedback"),n=t==null?void 0:t.innerHTML;t&&(t.disabled=!0,t.innerHTML="‚è≥ Enviando...");try{const s={usuario:E.getCurrentUser()||"usu√°rio n√£o identificado",frameUrl:this.currentResult.frameInfo.url,tipoProblema:e.type,nomeComponente:e.componentName,classificacaoEsperada:e.expectedClassification,descricao:e.description};await k.processFeedback(s);const a=L.parseUrl(this.currentResult.frameInfo.url);if(a)m.addFeedbackToPattern(a.nodeId,e),this.uiManager.showSuccess("‚úÖ Feedback processado com sucesso! O sistema aprendeu com seu feedback."),this.uiManager.updateLearningStats(),this.uiManager.updatePatternsCount(),this.cancelFeedback(),console.log("üìö Feedback salvo:",e),console.log("üìä Dados enviados para planilha:",s),console.log("üß† Sistema aprendeu e criou novas regras autom√°ticas");else throw new Error("N√£o foi poss√≠vel identificar o frame para salvar o feedback")}catch(o){console.error("Erro ao processar feedback:",o),this.uiManager.showError(o instanceof Error?o.message:"Erro ao processar feedback")}finally{t&&n&&(t.disabled=!1,t.innerHTML=n)}}}document.addEventListener("DOMContentLoaded",()=>{new O});window.FigmaAnalyzerApp=O;
